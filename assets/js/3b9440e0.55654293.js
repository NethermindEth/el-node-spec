"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[920],{3905:(e,a,t)=>{t.d(a,{Zo:()=>p,kt:()=>m});var n=t(7294);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function o(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function l(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?o(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function s(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var i=n.createContext({}),d=function(e){var a=n.useContext(i),t=a;return e&&(t="function"==typeof e?e(a):l(l({},a),e)),t},p=function(e){var a=d(e.components);return n.createElement(i.Provider,{value:a},e.children)},c="mdxType",h={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},u=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),c=d(t),u=r,m=c["".concat(i,".").concat(u)]||c[u]||h[u]||o;return t?n.createElement(m,l(l({ref:a},p),{},{components:t})):n.createElement(m,l({ref:a},p))}));function m(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var o=t.length,l=new Array(o);l[0]=u;var s={};for(var i in a)hasOwnProperty.call(a,i)&&(s[i]=a[i]);s.originalType=e,s[c]="string"==typeof e?e:r,l[1]=s;for(var d=2;d<o;d++)l[d]=t[d];return n.createElement.apply(null,l)}return n.createElement.apply(null,t)}u.displayName="MDXCreateElement"},947:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>i,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>d});var n=t(7462),r=(t(7294),t(3905));const o={title:"Demo"},l=void 0,s={unversionedId:"graft/demo",id:"graft/demo",title:"Demo",description:"This section contains the step sequence to create dashboards and panels using graft.",source:"@site/docs/graft/demo.md",sourceDirName:"graft",slug:"/graft/demo",permalink:"/docs/graft/demo",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/graft/demo.md",tags:[],version:"current",frontMatter:{title:"Demo"},sidebar:"tutorialSidebar",previous:{title:"Panels",permalink:"/docs/graft/panels"},next:{title:"The UID importance",permalink:"/docs/graft/the-uid-importance"}},i={},d=[{value:"Setting up the environment",id:"setting-up-the-environment",level:2},{value:"Creating dashboards and panels",id:"creating-dashboards-and-panels",level:2},{value:"Dashboard",id:"dashboard",level:3},{value:"Panel",id:"panel",level:3},{value:"Backup panels and dashboards",id:"backup-panels-and-dashboards",level:2},{value:"Dashboard",id:"dashboard-1",level:3},{value:"Panel",id:"panel-1",level:3}],p={toc:d},c="wrapper";function h(e){let{components:a,...o}=e;return(0,r.kt)(c,(0,n.Z)({},p,o,{components:a,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This section contains the step sequence to create dashboards and panels using graft."),(0,r.kt)("h2",{id:"setting-up-the-environment"},"Setting up the environment"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("a",{parentName:"p",href:"/docs/graft/config"},"Click here to see the Configuration section"))),(0,r.kt)("p",null,"The first thing that we need is a Grafana and Prometheus instance. To do this you can use a simple docker-compose file like the one below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"version: '3.8'\n\nservices:\n  grafana:\n    image: grafana/grafana:9.1.7\n    environment:\n      - GF_SECURITY_ADMIN_USER=<user>\n      - GF_SECURITY_ADMIN_PASSWORD=<password>\n    ports:\n      - 3000:3000\n    volumes:\n      - grafana-storage:/var/lib/grafana\n  prometheus:\n    image: prom/prometheus:v2.43.0\n    expose:\n      - 9090\n    ports:\n      - 9090:9090\n    volumes:\n      - prometheus-data:/prometheus\n\nvolumes:\n  grafana-storage:\n  prometheus-data:\n")),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Replace ",(0,r.kt)("inlineCode",{parentName:"p"},"<user>")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"<password>")," in the docker-compose file above with the desired username and password for the Grafana instance.")),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"You need to have a middleware metrics provider that could be a real middleware or a mock middleware instance. You need to configure prometheus properly to scrape the metrics from the middleware. For more information about how to configure prometheus to scrape metrics check the ",(0,r.kt)("a",{parentName:"p",href:"https://prometheus.io/docs/prometheus/latest/configuration/configuration/"},"Prometheus documentation"),".")),(0,r.kt)("p",null,"Once services are up and running, the next thing to do is create the Eigen Layer folder in the Grafana instance, and this folder is the one that will contain all the dashboards and panels that will be saved at the end. To do this, run the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"graft init\n")),(0,r.kt)("p",null,"This command also creates the empty ",(0,r.kt)("inlineCode",{parentName:"p"},"graft.yml")," configuration file in the current directory."),(0,r.kt)("p",null,"Now check that the Eigen Layer folder is created in the Grafana instance in the Dashboard section like the image below:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Eigen Layer folder",src:t(3512).Z,width:"2880",height:"1602"})),(0,r.kt)("p",null,"Now you need to add the prometheus datasource to Grafana. To do this replace the ",(0,r.kt)("inlineCode",{parentName:"p"},"graft.yml")," configuration file content in the current directory with the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"datasources:\n  - name: Eigen DA\n    uid: el-eigen_da\n    type: prometheus\n    url: http://prometheus:9090\n    access: proxy\n")),(0,r.kt)("p",null,"Now run the following command to check the configuration diff:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"graft config diff\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Output:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"+ DATA SOURCE Eigen DA (el-eigen_da)\n  + Name: Eigen DA\n  + UID: el-eigen_da\n  + Type: prometheus\n  + URL: http://prometheus:9090\n  + Access: proxy\n")),(0,r.kt)("p",null,"Diff output shows that the data source is not present in the Grafana instance, now run the following command to apply the configuration:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"graft config apply\n")),(0,r.kt)("p",null,"If everything goes well, you should see a log message with ",(0,r.kt)("inlineCode",{parentName:"p"},"Creating data source Eigen DA el-eigen_da"),". Also you can check the Grafana datasources section and see something like the image below:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"EigenDA datasource",src:t(6155).Z,width:"2880",height:"1602"})),(0,r.kt)("p",null,"To check that the datasource is working, click on the Eigen DA datasource and press the ",(0,r.kt)("inlineCode",{parentName:"p"},"Save & Test")," button at the end of the page. If everything goes well, you should see a message like the image below:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"EigenDA datasource test",src:t(6911).Z,width:"2880",height:"1600"})),(0,r.kt)("h2",{id:"creating-dashboards-and-panels"},"Creating dashboards and panels"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("a",{parentName:"p",href:"/docs/graft/dashboards"},"Click here to see the Dashboard section"))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("a",{parentName:"p",href:"/docs/graft/panels"},"Click here to see the Panel section"))),(0,r.kt)("h3",{id:"dashboard"},"Dashboard"),(0,r.kt)("p",null,"Now the environment is set up, next step is to create a dashboard. To do this run the ",(0,r.kt)("inlineCode",{parentName:"p"},"graft dashboard create")," command to create the dashboard in the Eigen Layer folder. In this case we are going to create a dashboard called ",(0,r.kt)("inlineCode",{parentName:"p"},"Demo"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"graft dashboard create Demo\n")),(0,r.kt)("p",null,"Now you can check that the dashboard is created in the Eigen Layer folder like the image below:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Eigen Layer dashboard",src:t(1385).Z,width:"2880",height:"1596"})),(0,r.kt)("p",null,"Now you can open the dashboard in Grafana, which is empty at the moment, and start editing it adding panels."),(0,r.kt)("h3",{id:"panel"},"Panel"),(0,r.kt)("p",null,"To create a panel, and be available in the Library panel section run the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'graft panel init --name "Demo panel" --uid el-eigenda-panel-demo\n')),(0,r.kt)("p",null,"This command creates a new panel with the name ",(0,r.kt)("inlineCode",{parentName:"p"},"Demo panel")," and the UID ",(0,r.kt)("inlineCode",{parentName:"p"},"el-eigenda-panel-demo")," in the ",(0,r.kt)("inlineCode",{parentName:"p"},"panels")," folder. Now it could be used in the dashboard created previously to edit it. To add the panel press the add panel option at the top-right section and select the ",(0,r.kt)("inlineCode",{parentName:"p"},"Add a panel from the panel library")," option like the image below:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Eigen Layer add panel",src:t(3324).Z,width:"2880",height:"1594"})),(0,r.kt)("p",null,"Select the ",(0,r.kt)("inlineCode",{parentName:"p"},"Demo panel")," and it will be added to the dashboard"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Select panel",src:t(3724).Z,width:"2880",height:"1598"})),(0,r.kt)("p",null,"The first time the panel is added, a ",(0,r.kt)("em",{parentName:"p"},"Panel plugin not found")," error message will be shown in the panel placeholder. This is normal behavior because the panel is completely empty. At this point, you can start editing the panel and adding the desired metrics and visualization. Once the panel is ready, press the ",(0,r.kt)("inlineCode",{parentName:"p"},"Save library panel")," button at the top-right section of the panel editor like the image below:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Save panel",src:t(3596).Z,width:"2880",height:"1588"})),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Because it is a library panel a confirmation message will be shown asking if you want to save the panel and displaying the list of dashboards that will be affected by the change. This is because a library panel could be used for multiple dashboards. In this case, select ",(0,r.kt)("inlineCode",{parentName:"p"},"Update all")," and will be ok."),(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("img",{alt:"Save panel confirmation",src:t(2683).Z,width:"1532",height:"614"}))),(0,r.kt)("p",null,"This is how the dashboard looks now:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Dashboard with panel",src:t(5480).Z,width:"2880",height:"1600"})),(0,r.kt)("h2",{id:"backup-panels-and-dashboards"},"Backup panels and dashboards"),(0,r.kt)("h3",{id:"dashboard-1"},"Dashboard"),(0,r.kt)("p",null,"To backup dashboards in the Eigen Layer folder (all the ones created by graft), run the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"graft dashboard backup\n")),(0,r.kt)("p",null,"Then you can check the dashboards folder and see the JSON files, one for each dashboard."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"$ tree dashboards\ndashboards\n\u2514\u2500\u2500 Demo.json\n\n0 directories, 1 file\n")),(0,r.kt)("h3",{id:"panel-1"},"Panel"),(0,r.kt)("p",null,"To backup panels in the Eigen Layer folder (all the ones created by graft) run the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"graft panel backup\n")),(0,r.kt)("p",null,"Then you can check the panels folder and see the JSON files, one for each panel:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"tree panels\npanels\n\u2514\u2500\u2500 el-eigenda-panel-demo.json\n\n0 directories, 1 file\n")))}h.isMDXComponent=!0},3324:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/graft-el-addpanel-57efc435d547e98045b592266ada6adc.png"},1385:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/graft-el-dashboard-list-67f84623b3f3dff7de1c284db4e16d0a.png"},5480:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/graft-el-dashboard-panel-b8c86c419d9bd2082f7c3bc094e6c5aa.png"},6911:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/graft-el-datasource-test-9523f39e5ebfee9f8066c39c02c03bee.png"},6155:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/graft-el-datasources-f9f99be95a973e568dd58ba0d44454f3.png"},3512:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/graft-el-folder-2ffb069ddad4770bbd8bde592d27b390.png"},2683:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/graft-el-panel-save-confirm-13a59ba2e8029bef2c9ce028cebcef81.png"},3596:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/graft-el-panel-save-415c0c5ead066d2de74ae3568b4f2964.png"},3724:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/graft-el-select-panel-b4e709e83bc3adcf7a743505e3550e6e.png"}}]);