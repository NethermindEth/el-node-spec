"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7867],{3905:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>f});var i=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)t=o[i],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)t=o[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=i.createContext({}),l=function(e){var n=i.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},d=function(e){var n=l(e.components);return i.createElement(s.Provider,{value:n},e.children)},m="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},u=i.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,d=p(e,["components","mdxType","originalType","parentName"]),m=l(t),u=r,f=m["".concat(s,".").concat(u)]||m[u]||c[u]||o;return t?i.createElement(f,a(a({ref:n},d),{},{components:t})):i.createElement(f,a({ref:n},d))}));function f(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,a=new Array(o);a[0]=u;var p={};for(var s in n)hasOwnProperty.call(n,s)&&(p[s]=n[s]);p.originalType=e,p[m]="string"==typeof e?e:r,a[1]=p;for(var l=2;l<o;l++)a[l]=t[l];return i.createElement.apply(null,a)}return i.createElement.apply(null,t)}u.displayName="MDXCreateElement"},8001:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>a,default:()=>c,frontMatter:()=>o,metadata:()=>p,toc:()=>l});var i=t(7462),r=(t(7294),t(3905));const o={sidebar_position:3,id:"profiles"},a="Profile file",p={unversionedId:"spec/packaging/profiles",id:"spec/packaging/profiles",title:"Profile file",description:"The configuration/profile file should be in YAML format and contain information about the AVS Node profile and its options. Options are any argument, flag, configuration value, or environment variable of any services within the AVS Node docker-compose.yml whose value might be required from the user input.",source:"@site/docs/spec/packaging/profiles.md",sourceDirName:"spec/packaging",slug:"/spec/packaging/profiles",permalink:"/docs/spec/packaging/profiles",draft:!1,editUrl:"https://github.com/NethermindEth/el-node-spec/edit/main/docs/docs/spec/packaging/profiles.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,id:"profiles"},sidebar:"sidebar",previous:{title:"Manifest file",permalink:"/docs/spec/packaging/manifest"},next:{title:"Reference package",permalink:"/docs/spec/packaging/reference"}},s={},l=[{value:"Profile file specification",id:"profile-file-specification",level:2},{value:"Profile file",id:"profile-file-1",level:3},{value:"<code>&lt;hardware_requirements_overrides&gt;</code>",id:"hardware_requirements_overrides",level:3},{value:"<code>&lt;plugin_overrides&gt;</code>",id:"plugin_overrides",level:3},{value:"<code>&lt;option&gt;</code>",id:"option",level:3},{value:"<code>&lt;type&gt;</code>",id:"type",level:3},{value:"<code>&lt;validate&gt;</code>",id:"validate",level:3},{value:"<code>&lt;monitoring&gt;</code>",id:"monitoring",level:3},{value:"<code>&lt;monitoring-target&gt;</code>",id:"monitoring-target",level:3},{value:"<code>&lt;api&gt;</code>",id:"api",level:3},{value:"Monitoring and metrics settings",id:"monitoring-and-metrics-settings",level:2},{value:"Profile schema",id:"profile-schema",level:2}],d={toc:l},m="wrapper";function c(e){let{components:n,...t}=e;return(0,r.kt)(m,(0,i.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"profile-file"},"Profile file"),(0,r.kt)("p",null,"The configuration/profile file should be in YAML format and contain information about the AVS Node profile and its options. Options are any argument, flag, configuration value, or environment variable of any services within the AVS Node ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," whose value might be required from the user input. "),(0,r.kt)("p",null,"The file\u2019s name ",(0,r.kt)("strong",{parentName:"p"},"MUST")," be ",(0,r.kt)("inlineCode",{parentName:"p"},"profile.yml"),"."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," is designed for a given setup of a given AVS Node version, and may have hardcoded values or settings, either in the ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," or in the form of environment variables in a ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," file with values. Settings could also be declared in the profile file in the ",(0,r.kt)("inlineCode",{parentName:"p"},"options")," section, considering that an option is a flag mapping to an environment variable in the ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," file. "),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"/docs/category/avs-setup-wizard"},"AVS setup wizard tool")," would use each option or setting in the profile file to get this information from the user via prompts, arguments, or CLI flags. In case of an upgrade, values of unchanged settings can be used in the new version, and values for new settings would have to be requested by the user. "),(0,r.kt)("p",null,"Because values for settings could be declared in more than one place, we need to define some precedence rules, which are (from highest to lowest):"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"The value set with a CLI flag or through a prompt because the option is in the package profile"),(0,r.kt)("li",{parentName:"ol"},"The default value in the package profile if it is defined and is not set with the CLI"),(0,r.kt)("li",{parentName:"ol"},"Value hardcoded in the ",(0,r.kt)("inlineCode",{parentName:"li"},".env")," provided in the package by the AVS developer")),(0,r.kt)("h2",{id:"profile-file-specification"},"Profile file specification"),(0,r.kt)("h3",{id:"profile-file-1"},"Profile file"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"# Hardware Requirements overrides that will replace requirements from the manifest file for this profile\nhardware_requirements_overrides: <hardware_requirements_overrides>\n\n# Plugin overrides that will replace plugin from the manifest file for this profile\nplugin_overrides: <plugin_overrides>\n\n# List of options the user can set or use default values if defined in the <option>. Each option is an environment variable in the docker-compose file, Developers need to be careful about what options to expose here\noptions:\n    [ - <option> ]\n\n# Monitoring options\nmonitoring: <monitoring>\n\n# AVS API configuration\napi: <api>\n")),(0,r.kt)("h3",{id:"hardware_requirements_overrides"},(0,r.kt)("inlineCode",{parentName:"h3"},"<hardware_requirements_overrides>")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"# Minimum number of CPU cores\nmin_cpu_cores: <int>\n\n# Minimum free memory space needed to run this profile in MiB\nmin_ram: <int>\n\n# Minimum free disk space needed to run this profile in MiB\nmin_free_space: <int>\n\n")),(0,r.kt)("h3",{id:"plugin_overrides"},(0,r.kt)("inlineCode",{parentName:"h3"},"<plugin_overrides>")),(0,r.kt)("p",null,"See the ",(0,r.kt)("a",{parentName:"p",href:"/docs/category/plugin"},"plugin documentation")," to learn more about the plugin system."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"# Pre-built image name ready to be pulled.\nimage: <string>\n")),(0,r.kt)("h3",{id:"option"},(0,r.kt)("inlineCode",{parentName:"h3"},"<option>")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"# Name of the flag that the end-user will use to reference this option with the AVS setup wizard\nname: <string>\n\n# Key of the env variable used in the docker-compose file\ntarget: <string>\n\n# Data type of the option: enum, int, float, string, bool, etc. These types are defined below with more details\ntype: <type>\n\n# Default value\ndefault: <int | float | bool | string>\n\n# Custom validation defined for this value\nvalidate: <validate>\n\n# Whether this option input should be hidden from the user\nhidden: <bool>\n\n# Help description about this \nhelp: <string>\n")),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"hidden")," field is optional and defaults to ",(0,r.kt)("inlineCode",{parentName:"p"},"false"),". If ",(0,r.kt)("inlineCode",{parentName:"p"},"hidden")," is set to ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),", the option value will be shown to the user as ",(0,r.kt)("inlineCode",{parentName:"p"},"********")," in the prompt in the AVS setup wizard tool.")),(0,r.kt)("h3",{id:"type"},(0,r.kt)("inlineCode",{parentName:"h3"},"<type>")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'int: 42\nfloat: 3.14\nbool: true\nstr: "Hello, World!"\npath_dir: ./path/to/a/dir\npath_file: ./path/to/a/file\nuri: https://eigenlayer.com\nselect: option1\nport: 8080\n')),(0,r.kt)("p",null,"These types will be used for automatic validation of the values provided by the user. For instance, if the setting\u2019s type is ",(0,r.kt)("inlineCode",{parentName:"p"},"path_file"),", the AVS setup wizard tool would validate that a file exists on the provided path."),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Any port exposed under the ",(0,r.kt)("inlineCode",{parentName:"p"},"ports:")," field in the ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," ",(0,r.kt)("strong",{parentName:"p"},"MUST")," be represented by an ",(0,r.kt)("inlineCode",{parentName:"p"},"option")," within the ",(0,r.kt)("inlineCode",{parentName:"p"},"options")," list in the profile file, and the type ",(0,r.kt)("inlineCode",{parentName:"p"},"port")," ",(0,r.kt)("strong",{parentName:"p"},"MUST")," be used. This allows port collision checks between multiple AVS Nodes running in the same host machine."),(0,r.kt)("p",{parentName:"admonition"},"The AVS setup wizard tool could do these checks to guarantee an open port for each port target.")),(0,r.kt)("p",null,"For those values that need to be unique across several AVS Node setups, for example, container names, you can use the type ",(0,r.kt)("inlineCode",{parentName:"p"},"string")," and provide a ",(0,r.kt)("inlineCode",{parentName:"p"},"validate.re2_regex")," to validate any desired rule. For example, the ",(0,r.kt)("inlineCode",{parentName:"p"},"validate.re2_regex")," for single word identifier can be ",(0,r.kt)("inlineCode",{parentName:"p"},"^[a-zA-Z]+$"),"."),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Using the ",(0,r.kt)("inlineCode",{parentName:"p"},"container_name")," service field in the ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," is optional, but if it is used, it is ",(0,r.kt)("strong",{parentName:"p"},"strongly recommended")," to provide an ",(0,r.kt)("inlineCode",{parentName:"p"},"option")," within the ",(0,r.kt)("inlineCode",{parentName:"p"},"options")," list with type ",(0,r.kt)("inlineCode",{parentName:"p"},"string")," in the profile file. This allows name collision checks between multiple AVS Nodes running in the same host machine."),(0,r.kt)("p",{parentName:"admonition"},"The AVS setup wizard tool could do the necessary checks to guarantee unique container names.")),(0,r.kt)("h3",{id:"validate"},(0,r.kt)("inlineCode",{parentName:"h3"},"<validate>")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'# RE2 regex https://github.com/google/re2/wiki/Syntax. Will be ignored if it is used for a type different from <string>\nre2_regex: <string>\n\n# Format of the file to validate. A leading dot is required for the format, like ".txt". Will be ignored if it is used for a type different from <path_file>\nformat: <string>\n\n# List of accepted URL schemes. Will be ignored if it is used for a type different from <uri>\nuri_scheme: [ - <string> ]\n\n# Min value that could be, included. Will be ignored if it is used for a type different from <int> or <float>\nmin_value: <int|float>\n\n# Max value that could be, included. Will be ignored if it is used for a type different from <int> or <float>\nmax_value: <int|float>\n\n# List of possible options to select. Will be ignored if it is used for a type different from <select>\noptions: [ - <string> ]\n')),(0,r.kt)("h3",{id:"monitoring"},(0,r.kt)("inlineCode",{parentName:"h3"},"<monitoring>")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"# List of metric targets inside the docker-compose\ntargets:\n    [ - <monitoring-target> ]\n")),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"The profile ",(0,r.kt)("strong",{parentName:"p"},"MUST")," provide a monitoring target at least.")),(0,r.kt)("h3",{id:"monitoring-target"},(0,r.kt)("inlineCode",{parentName:"h3"},"<monitoring-target>")),(0,r.kt)("p",null,"Represents a Prometheus endpoint inside the AVS Node setup."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"# Name of the docker-compose service\nservice: <string>\n\n# Port serving the metrics\nport: <int>\n\n# Metrics path, for instance: /metrics\npath: <string>\n")),(0,r.kt)("h3",{id:"api"},(0,r.kt)("inlineCode",{parentName:"h3"},"<api>")),(0,r.kt)("p",null,"Defines the AVS Node API endpoint that the AVS Node exposes following the ",(0,r.kt)("a",{parentName:"p",href:"/docs/category/avs-node-api"},"AVS Node API specification"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"# Name of the docker-compose service exposing the API\nservice: <string>\n\n# Port serving the API\nport: <int>\n")),(0,r.kt)("h2",{id:"monitoring-and-metrics-settings"},"Monitoring and metrics settings"),(0,r.kt)("p",null,"An AVS Node environment is a set of services deployed with Docker in the same Docker network. Prometheus metrics can be fetched from exporters that each service could implement. To know where these metrics are, we can rely on ",(0,r.kt)("a",{parentName:"p",href:"https://docs.docker.com/config/containers/container-networking/"},"docker container networking")," to reference services."),(0,r.kt)("p",null,"The monitoring setup is the set of a Grafana instance, Prometheus, and Node Exporter. Details about this monitoring stack can be found ",(0,r.kt)("a",{parentName:"p",href:"/docs/category/monitoring-stack"},"here"),"."),(0,r.kt)("p",null,"The profile file is the place to declare Prometheus targets inside the AVS Node setup mentioning the service name, port, and path to get metrics (",(0,r.kt)("inlineCode",{parentName:"p"},"monitoring-target"),")."),(0,r.kt)("p",null,"The metrics port could be exposed in the ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," for it to be reachable from outside the host machine, but is not mandatory to do so."),(0,r.kt)("h2",{id:"profile-schema"},"Profile schema"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'$schema: "http://json-schema.org/draft-07/schema#"\n# Definitions of all types of Option\ndefinitions:\n  OptionInt:\n    type: object\n    properties:\n      name:\n        type: string\n      target:\n        type: string\n      help:\n        type: string\n      type:\n        const: "int"\n      default:\n        type: integer\n      validate:\n        type: object\n        properties:\n          min_value:\n            type: integer\n          max_value:\n            type: integer\n        required:\n          - min_value\n          - max_value\n        additionalProperties: false\n    required:\n      - name\n      - target\n      - help\n      - type\n    additionalProperties: false \n  OptionString:\n    type: object\n    properties:\n      name:\n        type: string\n      target:\n        type: string\n      help:\n        type: string\n      type:\n        const: "str"\n      default:\n        type: string\n      validate:\n        type: object\n        properties:\n          re2_regex:\n            type: string\n        required:\n          - re2_regex\n        additionalProperties: false \n    required:\n      - name\n      - target\n      - help\n      - type\n    additionalProperties: false\n  OptionFloat:\n    type: object\n    properties:\n      name:\n        type: string\n      target:\n        type: string\n      help:\n        type: string\n      type:\n        const: "float"\n      default:\n        type: number\n      validate:\n        type: object\n        properties:\n          min_value:\n            type: number\n          max_value:\n            type: number\n        required:\n          - min_value\n          - max_value\n        additionalProperties: false\n    required:\n      - name\n      - target\n      - help\n      - type\n    additionalProperties: false\n  OptionBool:\n    type: object\n    properties:\n      name:\n        type: string\n      target:\n        type: string\n      help:\n        type: string\n      type:\n        const: "bool"\n      default:\n        type: boolean\n    required:\n      - name\n      - target\n      - help\n      - type\n    additionalProperties: false\n  OptionPathDir:\n    type: object\n    properties:\n      name:\n        type: string\n      target:\n        type: string\n      help:\n        type: string\n      type:\n        const: "path_dir"\n      default:\n        type: string\n    required:\n      - name\n      - target\n      - help\n      - type\n    additionalProperties: false\n  OptionPathFile:\n    type: object\n    properties:\n      name:\n        type: string\n      target:\n        type: string\n      help:\n        type: string\n      type:\n        const: "path_file"\n      default:\n        type: string\n      validate:\n        type: object\n        properties:\n          format:\n            type: string\n        required:\n          - format\n        additionalProperties: false \n    required:\n      - name\n      - target\n      - help\n      - type\n    additionalProperties: false\n  OptionURI:\n    type: object\n    properties:\n      name:\n        type: string\n      target:\n        type: string\n      help:\n        type: string\n      type:\n        const: "uri"\n      default:\n        type: string\n      validate:\n        type: object\n        properties:\n          uri_scheme:\n            type: array\n            minItems: 1\n            items:\n              type: string\n        required:\n          - uri_scheme\n        additionalProperties: false \n    required:\n      - name\n      - target\n      - help\n      - type\n    additionalProperties: false\n  OptionSelect:\n    type: object\n    properties:\n      name:\n        type: string\n      target:\n        type: string\n      help:\n        type: string\n      type:\n        const: "select"\n      default:\n        type: string\n      validate:\n        type: object\n        properties:\n          options:\n            type: array\n            minItems: 1\n            items:\n              type: string\n        required:\n          - options\n        additionalProperties: false \n    required:\n      - name\n      - target\n      - help\n      - type\n    additionalProperties: false\n  OptionPort:\n    type: object\n    properties:\n      name:\n        type: string\n      target:\n        type: string\n      help:\n        type: string\n      type:\n        const: "port"\n      default:\n        type: integer\n        minumum: 1\n        maximum: 65535\n    required:\n      - name\n      - target\n      - help\n      - type\n    additionalProperties: false\n\n# Profile Schema\ntype: object\nproperties:\n  name:\n    type: string\n  hardware_requirements_overrides:\n    type: object\n    properties:\n      min_cpu_cores:\n        type: integer\n        minimum: 0\n      min_ram:\n        type: integer\n        minimum: 0\n      min_free_space:\n        type: integer\n        minimum: 0\n      stop_if_requirements_are_not_met:\n        type: boolean\n    required:\n    - min_cpu_cores\n    - min_ram\n    - min_free_space\n    - stop_if_requirements_are_not_met\n    additionalProperties: false\n  plugin_overrides:\n    type: object\n    properties:\n      image:\n        type: string\n    required:\n    - image\n    additionalProperties: false\n  options:\n    type: array\n    items:\n      oneOf:\n        - $ref: \'#/definitions/OptionInt\'\n        - $ref: \'#/definitions/OptionString\'\n        - $ref: \'#/definitions/OptionFloat\'\n        - $ref: \'#/definitions/OptionBool\'\n        - $ref: \'#/definitions/OptionPathDir\'\n        - $ref: \'#/definitions/OptionPathFile\'\n        - $ref: \'#/definitions/OptionURI\'\n        - $ref: \'#/definitions/OptionSelect\'\n        - $ref: \'#/definitions/OptionPort\'\n  monitoring:\n    type: object\n    properties:\n      targets:\n        type: array\n        items:\n          type: object\n          properties:\n            service:\n              type: string\n            port:\n              type: integer\n              minumum: 1\n              maximum: 65535\n            path:\n              type: string\n          required:\n          - service\n          - path\n          - port\n          additionalProperties: false\n    required:\n      - targets\n    additionalProperties: false\n  api:\n    type: object\n    properties:\n      service:\n        type: string\n      port:\n        type: integer\n        minumum: 1\n        maximum: 65535\n    required:\n    - service\n    - port\n    additionalProperties: false\nrequired:\n  - monitoring\nadditionalProperties: false\n')))}c.isMDXComponent=!0}}]);